name: ì´ìŠˆ ìë™ í• ë‹¹

on:
  issues:
    types: [opened, reopened]

jobs:
  assign:
    runs-on: ubuntu-latest
    steps:
    - name: ì´ìŠˆ ìë™ í• ë‹¹
      uses: actions/github-script@v6
      with:
        script: |
          const issue = context.payload.issue;
          const title = issue.title.toLowerCase();
          const body = issue.body ? issue.body.toLowerCase() : '';
          
          // ê¸°ë³¸ ë‹´ë‹¹ì ëª©ë¡ (ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½ í•„ìš”)
          const defaultAssignees = ['yozmngood']; // ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
          
          let assignees = [defaultAssignees[0]]; // ê¸°ë³¸ í• ë‹¹
          
          // ì´ìŠˆ ë‚´ìš© ê¸°ë°˜ ë‹´ë‹¹ì ê²°ì •
          if (title.includes('backend') || body.includes('api') || body.includes('ì„œë²„')) {
            assignees = defaultAssignees;
          } else if (title.includes('frontend') || title.includes('ui') || title.includes('í™”ë©´')) {
            assignees = defaultAssignees;
          } else if (title.includes('bug') || title.includes('ë²„ê·¸')) {
            if (title.includes('critical') || title.includes('urgent') || title.includes('ê¸´ê¸‰')) {
              assignees = defaultAssignees;
            }
          }

          // ìë™ ë¼ë²¨ë§
          let labels = [];

          // ì´ìŠˆ íƒ€ì… ê¸°ë°˜ ë¼ë²¨ë§
          if (title.includes('[bug]') || title.includes('bug') || title.includes('ë²„ê·¸') || title.includes('ì˜¤ë¥˜')) {
            labels.push('type/bug');
          } else if (title.includes('[feat]') || title.includes('feature') || title.includes('ê¸°ëŠ¥')) {
            labels.push('type/feature');
          } else if (title.includes('[docs]') || title.includes('documentation') || title.includes('ë¬¸ì„œ')) {
            labels.push('type/documentation');
          } else if (title.includes('[question]') || title.includes('help') || title.includes('ì§ˆë¬¸')) {
            labels.push('type/question');
          }

          // ìš°ì„ ìˆœìœ„ ë¼ë²¨ë§
          if (title.includes('urgent') || title.includes('critical') || title.includes('ê¸´ê¸‰')) {
            labels.push('priority/high');
          } else if (title.includes('minor') || title.includes('ì‚¬ì†Œí•œ')) {
            labels.push('priority/low');
          } else {
            labels.push('priority/medium');
          }

          // ì˜ì—­ ê¸°ë°˜ ë¼ë²¨ë§
          if (title.includes('backend') || body.includes('api') || body.includes('ì„œë²„')) {
            labels.push('area/backend');
          }
          if (title.includes('frontend') || body.includes('ui') || body.includes('í™”ë©´')) {
            labels.push('area/frontend');
          }
          if (title.includes('test') || body.includes('í…ŒìŠ¤íŠ¸')) {
            labels.push('area/tests');
          }

          // ì¤‘ë³µ ì œê±°
          assignees = [...new Set(assignees)];
          labels = [...new Set(labels)];

          // ë¼ë²¨ ì¶”ê°€
          if (labels.length > 0) {
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: labels
            });
          }

          if (assignees.length > 0) {
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              assignees: assignees
            });

            let commentLines = [
              "ğŸ¯ **ìë™ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤**",
              "",
              `**í• ë‹¹ëœ ë‹´ë‹¹ì**: ${assignees.map(a => `@${a}`).join(', ')}`
            ];
            
            if (labels.length > 0) {
              commentLines.push("");
              commentLines.push(`**ì ìš©ëœ ë¼ë²¨**: ${labels.map(l => `\`${l}\``).join(', ')}`);
            }
            
            commentLines.push("");
            commentLines.push("ë‹´ë‹¹ìë¶„ë“¤ê»˜ì„œ ê³§ ì´ìŠˆë¥¼ í™•ì¸í•˜ê³  ì²˜ë¦¬í•  ì˜ˆì •ì…ë‹ˆë‹¤.");
            commentLines.push("ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° ëŒ“ê¸€ë¡œ ìš”ì²­ë“œë¦¬ê² ìŠµë‹ˆë‹¤.");
            commentLines.push("");
            commentLines.push("---");
            commentLines.push("*ğŸ¤– ìë™ í• ë‹¹ ë° ë¼ë²¨ë§ ì‹œìŠ¤í…œ*");
            
            const assignmentComment = commentLines.join('\n');

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: assignmentComment
            });
          }